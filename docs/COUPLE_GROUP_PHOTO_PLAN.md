# é›™äººèˆ‡å¤šäººå¯«çœŸåŠŸèƒ½è¦åŠƒï¼ˆæ–°å»ºç¨ç«‹åˆ†é ï¼‰

> ç›®æ¨™ï¼šæ–°å»º `/couple-group` åˆ†é ï¼Œå…§å«ã€Œé›™äººå¯«çœŸã€èˆ‡ã€Œå¤šäººå¯«çœŸã€å…©å€‹å­åˆ†é¡ã€‚

---

## ä¸€ã€é é¢çµæ§‹è¦åŠƒ

### 1.1 è·¯ç”±èˆ‡å°è¦½

**æ–°è·¯ç”±**ï¼š`/couple-group`

**å°è¦½ä½ç½®**ï¼š
- åœ¨ `StartTabNav` æ–°å¢ã€Œé›™äºº/å¤šäººå¯«çœŸã€æŒ‰éˆ•
- ç…§ç‰‡é¤¨ã€Œcoupleã€èˆ‡ã€Œgroupã€åˆ†é¡é …ç›®å°å‘ `/couple-group?mode=couple` æˆ– `/couple-group?mode=group`

### 1.2 é é¢å…§éƒ¨çµæ§‹

```
CoupleGroupPage
â”œâ”€â”€ StartTabNav (é ‚éƒ¨å°è¦½)
â”œâ”€â”€ æ¨™é¡Œå€å¡Š
â”‚   â”œâ”€â”€ ä¸»æ¨™é¡Œï¼šã€Œé›™äºº/å¤šäººå¯«çœŸã€
â”‚   â””â”€â”€ å‰¯æ¨™é¡Œèªªæ˜
â”œâ”€â”€ æ¨¡å¼åˆ‡æ› Tabï¼ˆé é¢å…§ï¼‰
â”‚   â”œâ”€â”€ ã€Œé›™äººå¯«çœŸã€Tab
â”‚   â””â”€â”€ ã€Œå¤šäººå¯«çœŸã€Tab
â””â”€â”€ å…§å®¹å€ï¼ˆä¾é¸ä¸­ Tab åˆ‡æ›ï¼‰
    â”œâ”€â”€ é›™äººå¯«çœŸæ¨¡å¼
    â”‚   â”œâ”€â”€ ä¸Šå‚³å€åŸŸï¼ˆ2 å€‹æª”æ¡ˆï¼‰
    â”‚   â”œâ”€â”€ é¢¨æ ¼é¸æ“‡ï¼ˆå½¢è±¡ç…§/ä¸»é¡Œå¯«çœŸ/æ—…éŠç…§ï¼‰
    â”‚   â”œâ”€â”€ é€²éšé¸é …ï¼ˆä¾é¢¨æ ¼è€Œå®šï¼‰
    â”‚   â””â”€â”€ ç”ŸæˆæŒ‰éˆ•
    â””â”€â”€ å¤šäººå¯«çœŸæ¨¡å¼
        â”œâ”€â”€ ä¸Šå‚³å€åŸŸï¼ˆ3-6 å€‹æª”æ¡ˆï¼‰
        â”œâ”€â”€ é¢¨æ ¼é¸æ“‡ï¼ˆå½¢è±¡ç…§/ä¸»é¡Œå¯«çœŸ/æ—…éŠç…§ï¼‰
        â”œâ”€â”€ é€²éšé¸é …ï¼ˆä¾é¢¨æ ¼è€Œå®šï¼‰
        â””â”€â”€ ç”ŸæˆæŒ‰éˆ•
```

---

## äºŒã€åŠŸèƒ½è¨­è¨ˆ

### 2.1 é›™äººå¯«çœŸæ¨¡å¼

**æª”æ¡ˆé™åˆ¶**ï¼šåš´æ ¼ 2 å€‹æª”æ¡ˆ

**æ”¯æ´é¢¨æ ¼**ï¼š
- **å½¢è±¡ç…§é¢¨æ ¼**ï¼šå°ˆæ¥­é›™äººç…§ã€æƒ…ä¾¶å½¢è±¡ç…§ã€é–¨èœœç…§
- **ä¸»é¡Œå¯«çœŸé¢¨æ ¼**ï¼šæ‹ç«‹å¾—ã€ç¾å¼æ ¡åœ’ã€å¾©å¤ã€æµªæ¼«
- **æ—…éŠç…§é¢¨æ ¼**ï¼šæ™¯é»é›™äººç…§ã€ç¾é£Ÿåœ°åœ–é›™äººç…§

**é€²éšé¸é …**ï¼š
- å½¢è±¡ç…§ï¼šé¸æ“‡å½¢è±¡é¡å‹ã€è¼¸å‡ºè¦æ ¼ï¼ˆåŠèº«/å…¨èº«ï¼‰
- ä¸»é¡Œå¯«çœŸï¼šé¸æ“‡ä¸»é¡Œé¡å‹
- æ—…éŠç…§ï¼šé¸æ“‡å ´æ™¯ã€é•·å¯¬æ¯”ã€é¢¨æ ¼ç­‰

### 2.2 å¤šäººå¯«çœŸæ¨¡å¼

**æª”æ¡ˆé™åˆ¶**ï¼š3-6 å€‹æª”æ¡ˆï¼ˆå»ºè­°ä¸Šé™ 4-6 äººï¼‰

**æ”¯æ´é¢¨æ ¼**ï¼š
- **å½¢è±¡ç…§é¢¨æ ¼**ï¼šå®¶åº­ç…§ã€ç•¢æ¥­åœ˜é«”ç…§ã€å…¬å¸åœ˜é«”ç…§
- **ä¸»é¡Œå¯«çœŸé¢¨æ ¼**ï¼šåœ˜é«”æ‹ç«‹å¾—ã€æ´¾å°ä¸»é¡Œ
- **æ—…éŠç…§é¢¨æ ¼**ï¼šåœ˜é«”æ—…éŠç…§ã€å®¶åº­å‡ºéŠç…§

**é€²éšé¸é …**ï¼š
- å½¢è±¡ç…§ï¼šé¸æ“‡å½¢è±¡é¡å‹ã€è¼¸å‡ºè¦æ ¼
- ä¸»é¡Œå¯«çœŸï¼šé¸æ“‡ä¸»é¡Œé¡å‹
- æ—…éŠç…§ï¼šé¸æ“‡å ´æ™¯ã€é•·å¯¬æ¯”ã€é¢¨æ ¼ç­‰

### 2.3 é¢¨æ ¼é¸æ“‡ UI

åœ¨é é¢å…§æä¾›é¢¨æ ¼åˆ‡æ›ï¼ˆé¡ä¼¼ `TravelUploadSection` çš„æ¨¡å¼åˆ‡æ›ï¼‰ï¼š

```
[å½¢è±¡ç…§] [ä¸»é¡Œå¯«çœŸ] [æ—…éŠç…§]
```

é¸æ“‡é¢¨æ ¼å¾Œï¼Œé¡¯ç¤ºå°æ‡‰çš„é€²éšé¸é …è¡¨å–®ã€‚

---

## ä¸‰ã€ç›®éŒ„çµæ§‹

```
features/
  couple-group/
    CoupleGroupPage.tsx          # ä¸»é é¢å®¹å™¨
    CoupleGroupModeTabs.tsx      # é›™äºº/å¤šäºº Tab åˆ‡æ›
    CoupleGroupUploadSection.tsx # ä¸Šå‚³å€åŸŸï¼ˆæ”¯æ´å¤šæª”æ¡ˆï¼‰
    CoupleGroupStyleSelector.tsx # é¢¨æ ¼é¸æ“‡ï¼ˆå½¢è±¡ç…§/ä¸»é¡Œå¯«çœŸ/æ—…éŠç…§ï¼‰
    CoupleGroupForm.tsx          # é€²éšé¸é …è¡¨å–®ï¼ˆä¾é¢¨æ ¼å‹•æ…‹é¡¯ç¤ºï¼‰
    CoupleGroupResult.tsx        # çµæœå±•ç¤º
    useCoupleGroup.ts            # Hookï¼šç‹€æ…‹ç®¡ç†ã€æª”æ¡ˆè™•ç†ã€ç”Ÿæˆé‚è¼¯
    types.ts                     # å‹åˆ¥å®šç¾©
```

---

## å››ã€æŠ€è¡“å¯¦ä½œ

### 4.1 ç‹€æ…‹ç®¡ç† (`useCoupleGroup.ts`)

```typescript
export type CoupleGroupMode = 'couple' | 'group';
export type CoupleGroupStyle = 'portrait' | 'themed' | 'travel';

export function useCoupleGroup() {
  const [mode, setMode] = useState<CoupleGroupMode>('couple'); // couple | group
  const [style, setStyle] = useState<CoupleGroupStyle>('portrait'); // portrait | themed | travel
  const [files, setFiles] = useState<File[]>([]);
  const [previewUrls, setPreviewUrls] = useState<string[]>([]);
  const [result, setResult] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  
  // é¢¨æ ¼ç›¸é—œç‹€æ…‹ï¼ˆä¾ style å‹•æ…‹ä½¿ç”¨ï¼‰
  const [portraitType, setPortraitType] = useState<PortraitType>(...);
  const [portraitSpec, setPortraitSpec] = useState<OutputSpec>(...);
  const [themedType, setThemedType] = useState<ThemedType>(...);
  const [travelScene, setTravelScene] = useState<string>(...);
  // ... å…¶ä»–æ—…éŠç…§é¸é …
  
  const handleGenerate = async () => {
    // é©—è­‰æª”æ¡ˆæ•¸é‡
    if (mode === 'couple' && files.length !== 2) {
      setError('é›™äººå¯«çœŸéœ€è¦ä¸Šå‚³ 2 å¼µç…§ç‰‡');
      return;
    }
    if (mode === 'group' && (files.length < 3 || files.length > 6)) {
      setError('å¤šäººå¯«çœŸéœ€è¦ä¸Šå‚³ 3-6 å¼µç…§ç‰‡');
      return;
    }
    
    // ä¾é¢¨æ ¼èª¿ç”¨å°æ‡‰çš„ç”Ÿæˆå‡½æ•¸
    if (style === 'portrait') {
      const result = await generateProfessionalPortrait(files, { ... });
      setResult(result);
    } else if (style === 'themed') {
      const result = await generateThemedPhoto(files, { ... });
      setResult(result);
    } else if (style === 'travel') {
      const result = await generateTravelPhoto(files, { ... });
      setResult(result);
    }
  };
  
  return { ... };
}
```

### 4.2 æª”æ¡ˆä¸Šå‚³é©—è­‰

```typescript
const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
  const selectedFiles = Array.from(e.target.files || []);
  
  if (mode === 'couple') {
    if (selectedFiles.length > 2) {
      setError('é›™äººå¯«çœŸæœ€å¤šä¸Šå‚³ 2 å¼µç…§ç‰‡');
      return;
    }
    setFiles(selectedFiles.slice(0, 2));
  } else if (mode === 'group') {
    if (selectedFiles.length > 6) {
      setError('å¤šäººå¯«çœŸæœ€å¤šä¸Šå‚³ 6 å¼µç…§ç‰‡');
      return;
    }
    setFiles(prev => [...prev, ...selectedFiles].slice(0, 6));
  }
};
```

### 4.3 Gemini æœå‹™èª¿æ•´

**éœ€è¦ä¿®æ”¹çš„æœå‹™å‡½æ•¸**ï¼š
1. `services/gemini/portrait.ts`ï¼š
   - `generateProfessionalPortrait` åƒæ•¸æ”¹ç‚º `File | File[]`
   - Prompt èª¿æ•´ï¼š2 äººæ™‚åŠ å…¥ "couple portrait"ï¼Œ3+ äººæ™‚åŠ å…¥ "group portrait" / "family portrait"

2. `services/gemini/themed.ts`ï¼š
   - `generateThemedPhoto` åƒæ•¸æ”¹ç‚º `File | File[]`
   - Prompt èª¿æ•´ï¼šå¤šäººæ™‚åŠ å…¥ "couple/group themed photoshoot"

3. `services/gemini/travel.ts`ï¼š
   - å·²æ”¯æ´ `File | File[]`ï¼Œç„¡éœ€ä¿®æ”¹

### 4.4 é é¢å…§ Tab åˆ‡æ› UI

```tsx
<div className="flex justify-center mb-6">
  <div className="flex bg-gray-900/60 p-1 rounded-full border border-gray-700/50">
    <button
      onClick={() => setMode('couple')}
      className={`px-6 py-2 rounded-full font-bold transition-all ${
        mode === 'couple'
          ? 'bg-pink-600 text-white shadow-lg'
          : 'text-gray-400 hover:text-gray-200'
      }`}
    >
      ğŸ’‘ é›™äººå¯«çœŸ
    </button>
    <button
      onClick={() => setMode('group')}
      className={`px-6 py-2 rounded-full font-bold transition-all ${
        mode === 'group'
          ? 'bg-purple-600 text-white shadow-lg'
          : 'text-gray-400 hover:text-gray-200'
      }`}
    >
      ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å¤šäººå¯«çœŸ
    </button>
  </div>
</div>
```

---

## äº”ã€ç…§ç‰‡é¤¨é …ç›®å°æ¥

### 5.1 è·¯ç”±åƒæ•¸è¨­è¨ˆ

**é›™äººå¯«çœŸé …ç›®**ï¼š
```
/couple-group?mode=couple&style=portrait&type=premium_leader
/couple-group?mode=couple&style=themed&type=themed-polaroid
/couple-group?mode=couple&style=travel&scene=eiffel
```

**å¤šäººå¯«çœŸé …ç›®**ï¼š
```
/couple-group?mode=group&style=portrait&type=business
/couple-group?mode=group&style=themed&type=themed-birthday
/couple-group?mode=group&style=travel&scene=taipei101
```

### 5.2 ç…§ç‰‡é¤¨é …ç›®èª¿æ•´

åœ¨ `constants/photographyService.ts` ä¸­ï¼š

```typescript
// é›™äººå¯«çœŸé …ç›®
{
  id: 'couple-romance',
  categoryId: 'couple',
  nameKey: 'service.item.couple_romance.name',
  targetRoute: '/couple-group',
  queryParams: { mode: 'couple', style: 'portrait', type: 'premium_leader' },
}

// å¤šäººå¯«çœŸé …ç›®
{
  id: 'group-family',
  categoryId: 'group',
  nameKey: 'service.item.group_family.name',
  targetRoute: '/couple-group',
  queryParams: { mode: 'group', style: 'portrait', type: 'business' },
}
```

---

## å…­ã€å¯¦ä½œæ­¥é©Ÿ

### Phase 1: åŸºç¤é é¢çµæ§‹
1. å»ºç«‹ `features/couple-group/` ç›®éŒ„
2. å»ºç«‹ `CoupleGroupPage.tsx`ï¼ˆåŸºæœ¬å®¹å™¨ï¼‰
3. å»ºç«‹ `CoupleGroupModeTabs.tsx`ï¼ˆé›™äºº/å¤šäººåˆ‡æ›ï¼‰
4. å»ºç«‹ `useCoupleGroup.ts`ï¼ˆåŸºç¤ç‹€æ…‹ç®¡ç†ï¼‰
5. åœ¨ `App.tsx` æ–°å¢è·¯ç”± `/couple-group`
6. åœ¨ `StartTabNav` æ–°å¢æŒ‰éˆ•

### Phase 2: ä¸Šå‚³èˆ‡é¢¨æ ¼é¸æ“‡
1. å»ºç«‹ `CoupleGroupUploadSection.tsx`ï¼ˆå¤šæª”æ¡ˆä¸Šå‚³ï¼‰
2. å»ºç«‹ `CoupleGroupStyleSelector.tsx`ï¼ˆå½¢è±¡ç…§/ä¸»é¡Œå¯«çœŸ/æ—…éŠç…§åˆ‡æ›ï¼‰
3. å¯¦ä½œæª”æ¡ˆé©—è­‰é‚è¼¯ï¼ˆé›™äºº 2 æª”ã€å¤šäºº 3-6 æª”ï¼‰

### Phase 3: é€²éšé¸é …è¡¨å–®
1. å»ºç«‹ `CoupleGroupForm.tsx`ï¼ˆä¾é¢¨æ ¼å‹•æ…‹é¡¯ç¤ºé¸é …ï¼‰
2. æ•´åˆå½¢è±¡ç…§é¸é …ï¼ˆé¡å‹ã€è¦æ ¼ï¼‰
3. æ•´åˆä¸»é¡Œå¯«çœŸé¸é …ï¼ˆä¸»é¡Œé¡å‹ï¼‰
4. æ•´åˆæ—…éŠç…§é¸é …ï¼ˆå ´æ™¯ã€é•·å¯¬æ¯”ç­‰ï¼‰

### Phase 4: ç”Ÿæˆèˆ‡çµæœ
1. ä¿®æ”¹ `services/gemini/portrait.ts` æ”¯æ´ `File[]`
2. ä¿®æ”¹ `services/gemini/themed.ts` æ”¯æ´ `File[]`
3. å»ºç«‹ `CoupleGroupResult.tsx`ï¼ˆçµæœå±•ç¤ºï¼‰
4. å¯¦ä½œç”Ÿæˆé‚è¼¯ï¼ˆä¾é¢¨æ ¼èª¿ç”¨å°æ‡‰æœå‹™ï¼‰

### Phase 5: ç…§ç‰‡é¤¨å°æ¥
1. æ›´æ–° `constants/photographyService.ts` ä¸­ã€Œcoupleã€èˆ‡ã€Œgroupã€é …ç›®çš„ `targetRoute`
2. æ–°å¢ `queryParams` åƒæ•¸
3. åœ¨ `CoupleGroupPage` ä¸­è®€å– URL åƒæ•¸ä¸¦é å¡«é¸é …

### Phase 6: å¤šèªèˆ‡æ¨£å¼
1. åœ¨ `LanguageContext` æ–°å¢ç›¸é—œç¿»è­¯ key
2. èª¿æ•´æ¨£å¼èˆ‡å‹•ç•«
3. æ¸¬è©¦èˆ‡å„ªåŒ–

---

## ä¸ƒã€æ³¨æ„äº‹é …

1. **æª”æ¡ˆæ•¸é‡é©—è­‰**ï¼šé›™äººåš´æ ¼ 2 æª”ï¼Œå¤šäºº 3-6 æª”ï¼Œéœ€æœ‰æ˜ç¢ºéŒ¯èª¤æç¤º
2. **æ¨¡å¼åˆ‡æ›**ï¼šåˆ‡æ›æ¨¡å¼æ™‚æ‡‰æ¸…ç©ºå·²ä¸Šå‚³æª”æ¡ˆæˆ–æç¤ºä½¿ç”¨è€…
3. **é¢¨æ ¼åˆ‡æ›**ï¼šåˆ‡æ›é¢¨æ ¼æ™‚ä¿ç•™å·²ä¸Šå‚³æª”æ¡ˆï¼Œä½†æ¸…ç©ºé¢¨æ ¼ç›¸é—œé¸é …
4. **URL åƒæ•¸**ï¼šæ”¯æ´å¾ç…§ç‰‡é¤¨å¸¶å…¥åƒæ•¸é å¡«é¸é …
5. **å‘å¾Œç›¸å®¹**ï¼šä¿®æ”¹ `generateProfessionalPortrait` å’Œ `generateThemedPhoto` æ™‚éœ€ä¿æŒå–®äººæ¨¡å¼å‘å¾Œç›¸å®¹
6. **Prompt å„ªåŒ–**ï¼šå¤šäººæ™‚éœ€æ˜ç¢ºæŒ‡å®šäººæ•¸èˆ‡é—œä¿‚ï¼ˆcouple / family / groupï¼‰

---

## å…«ã€é æœŸæˆæœ

å®Œæˆå¾Œï¼š
- âœ… æ–°å¢ `/couple-group` è·¯ç”±èˆ‡é é¢
- âœ… é é¢å…§æœ‰ã€Œé›™äººå¯«çœŸã€èˆ‡ã€Œå¤šäººå¯«çœŸã€Tab åˆ‡æ›
- âœ… æ”¯æ´å½¢è±¡ç…§ã€ä¸»é¡Œå¯«çœŸã€æ—…éŠç…§ä¸‰ç¨®é¢¨æ ¼
- âœ… ç…§ç‰‡é¤¨ã€Œcoupleã€èˆ‡ã€Œgroupã€é …ç›®å°å‘æ–°é é¢ä¸¦å¸¶å…¥åƒæ•¸
- âœ… `StartTabNav` æ–°å¢ã€Œé›™äºº/å¤šäººå¯«çœŸã€æŒ‰éˆ•
- âœ… å®Œæ•´çš„æª”æ¡ˆä¸Šå‚³ã€é©—è­‰ã€ç”Ÿæˆã€çµæœå±•ç¤ºæµç¨‹